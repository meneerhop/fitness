<script type="module">
  import { supabase } from "../js/supabaseClient.js";
  const msg = document.getElementById('msg');

  (async () => {
    try {
      // rond OAuth / magic-link af
      const { error } = await supabase.auth.exchangeCodeForSession(window.location.href);
      if (error) throw error;

      // ga naar 'next' als die er is
      const next = localStorage.getItem("mf-next") || "/";
      msg.textContent = "Gelukt! Je wordt doorgestuurdâ€¦";
      setTimeout(() => window.location.href = next, 500);
    } catch (e) {
      msg.textContent = "Er ging iets mis: " + e.message;
      msg.className = "notice error";
    }
  })();
</script>
